# **Статический анализ кода**

Стати́ческий ана́лиз ко́да (англ. static code analysis) — анализ программного обеспечения, производимый без реального выполнения исследуемых программ.

**Основная ценность** статического анализа заключается в его регулярном использовании, благодаря чему многие ошибки могут быть выявлены и устранены на самых ранних этапах. Нет смысла тратить 50 часов на поиск ошибки, которую можно найти благодаря анализу кода. **Основная польза** статического анализа - регулярно устранять десятки обычных ошибок день за днем.

# **Статические анализаторы кода, используемых для языка C#**

## PVS-Studio
#### https://www.viva64.com/ru/pvs-studio/

**PVS-Studio** — проприетарный статический анализатор кода для программ, написанных на С, C++, C++/CLI, C++/CX, C# и на Java

Приложение может интегрироваться с Microsoft Visual Studio, IntelliJ IDEA, Rider, SonarQube, Jenkins, TeamCity, IncrediBuild и так далее.

PVS-Studio выполняет статический анализ кода и генерирует отчёт, помогающий программисту находить и устранять ошибки. Приложение выполняет широкий спектр проверок кода, но наиболее силён в поисках опечаток и последствий неудачного Copy-Paste.

## ReSharper
#### https://www.jetbrains.com/ru-ru/resharper/

**ReSharper (R#)** — дополнение (плагин), разработанное компанией JetBrains для повышения продуктивности работы в Microsoft Visual Studio.

Проводит статический анализ кода (поиск ошибок в коде до компиляции) в масштабе всего решения, предусматривает дополнительные средства автозаполнения, навигации, поиска, подсветки синтаксиса, форматирования, оптимизации и генерации кода, предоставляет 40 автоматизированных рефакторингов, упрощает юнит-тестирование в средах MSTest и NUnit и др. Поддерживает языки программирования C#, C++, JavaScript, TypeScript и VB.NET, а также предоставляет средства для работы с ASP.NET, ASP.NET MVC, XML, XAML, HTML, CSS, сценариями сборки NAnt и MSBuild.


## FxCop

**FxCop** — бесплатный инструмент для статического анализа кода от Microsoft, проверяющий сборки .NET на соответствие рекомендациям по проектированию библиотек .NET Framework. В отличие от утилиты lint, FxCop анализирует скомпилированный объектный код, а не исходный код. FxCop использует разбор CIL и анализ графа вызовов для проверки сборок на наличие более чем 200 дефектов в следующих областях:

- Корректность
- Дизайн библиотек
- Интернационализация
- Соглашения именования
- Производительность
- Безопасность

FxCop представляет собой инструмент, помогающий разработчикам следовать корпоративным стандартам программирования. FxCop выполняет анализ кода для проверки соответствия стандартам программирования и соглашениям именования, и позволяет удостовериться, что соответствующие правила используются в написанной программе.

# **Сравнение PVS-Studio C# и статического анализатора, встроенного в Visual Studio, на базе кода проекта CruiseControl.NET**
>CruiseControl.NET — это сервер автоматической непрерывной интеграции, реализованный с использованием .NET Framework. Исходный код CruiseControl.NET доступен на GitHub. Проект уже некоторое время не развивается и не поддерживается, хотя, в недалёком прошлом пользовался определённой популярностью. Это не помешает применить его с целью сравнения анализаторов, скорее, даже наоборот, внесёт некий элемент стабильности в исследование. 

## **Исследование и результаты**
### **1. Visual Studio**

Проверка кода проекта при помощи встроенного в Visual Studio анализатора заняла всего пару минут. Сразу после этого результаты имеют следующий вид (никакие фильтры не включены):
![](https://hsto.org/getpro/habr/post_images/629/9fa/c08/6299fac082ad314ea7ce27855f6568ff.png)

Анализатор выдал 10773 предупреждения. Да, искать ошибки здесь будет не так-то просто. Для начала стоит исключить из данного списка предупреждения по проекту «UnitTests» при помощи фильтра:

![](https://hsto.org/getpro/habr/post_images/ca9/a9e/cf7/ca9a9ecf75696932f5dbc52c17c6b8db.png)

Почти половина предупреждений была получена для тестов, что неудивительно. Но более 5 тысяч оставшихся сообщений — тоже не мало. Также было выдано некоторое количество предупреждений компилятора. Видимо, не остается другого выбора, кроме как изучить описание каждой из полученных диагностик анализатора, а уже затем проводить изучение предупреждений в случае необходимости.

### **1. PVS-Studio**

Проверка кода проекта с помощью PVS-Studio заняла ровно минуту. Сразу после этого результаты имеют вид (никакие фильтры не включены):

![](https://hsto.org/getpro/habr/post_images/4e3/66d/b33/4e366db33c298ad0aae79b80f11a8faf.png)

Анализатор выдал 198 предупреждений. И них 45 было получено для проекта «UnitTests», а ещё 32 предупреждения имеют низкий приоритет (среди них сложно найти реальные ошибки). Итого — 121 сообщение для анализа, на который было потрачено 30 минут. В результате было выявлено 19 ошибок:

![](https://hsto.org/getpro/habr/post_images/4da/4f8/4ef/4da4f84ef9a12d0532aa2a5cf40cdb66.png)

## **Заключение**

![](https://hsto.org/getpro/habr/post_images/7d1/4d0/f62/7d14d0f627ad2ca5fb68d6582fe60c1e.png)

Конечно, очевидный перевес наблюдается на стороне PVS-Studio. Но, стоит сказать, встроенный в Visual Studio анализатор предназначен, в первую очередь, ***для улучшения дизайна и оптимизации кода***, а не для поиска ошибок. В то время как PVS-Studio, наоборот, «заточен» на поиск ошибок с выдачей минимально возможного уровня ложных предупреждений. К тому же, разработчики CruiseControl.NET, по всей видимости, не применяли вообще никаких анализаторов.


**Источники:** 
1. https://ru.wikipedia.org/wiki/FxCop
2. https://ru.wikipedia.org/wiki/Статический_анализ_кода
3. https://ru.wikipedia.org/wiki/PVS-Studio
4. https://ru.wikipedia.org/wiki/ReSharper
5. https://habr.com/ru/company/pvs-studio/blog/328354/